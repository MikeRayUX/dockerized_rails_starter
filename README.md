# Dockerized Ruby on Rails 6+ Starter Pack

### Setup Step 1.: Personalize your new project and setup a new git repository

1. **Clone the project:**

```bash
git clone git@github.com:MichaelArriaga/dockerized_rails_starter.git
```

2. **Rename the project folder to your desired project name**

```bash
mv rn-starter-pack/ my_new_awsome_project
```

3. **Replace and setup a git repository**

   1. Remove the existing git repository: `cd my_new_awsome_project && rm -rf .git`
   2. Initialize a new git repository `git init`
   3. Create a new project on github
   4. Use standard remote repository setup instructions from github to push your new project to the new remote repository `git push -u origin master`

### Setup Step 2.: Docker Setup/Configuration

1. **Set the permissions for `docker_entrypoint.sh` and `webpack-dev-server` files**

```bash
chmod u+x docker_entrypoint.sh
chmod +x app/bin/webpack-dev-server
```

2. **Build docker containers and project**

```bash
docker-compose down --remove orphans &&
docker-compose build &&
docker-compose run app yarn install --check-files &&
docker-compose run app bundle install
```

3. **Create/migrate database**

```bash
docker-compose run app bundle exec rails db:create &&
docker-compose run app bundle exec rails db:migrate &&
docker-compose run app bundle exec rails db:seed &&
```

4. **Remove any orphan containers from the build process and start the Rails Server**

```bash
docker-compose down --remove orphans &&
docker-compose up --remove-orphans
```

5. **Access the app from http://localhost:3000/. You should now be greeted with the standard demo page **

---

### Setup Step3.: Configure your Rails App

1. `application.html.erb`:

Configure/customize the `application.html.erb` layout and the various `layouts/headers/*` header partials included in it for numerous seo services/fonts/icons/e.t.c.

Below is a breakdown of each partial and their use:

- `_seo_meta_tags.html.erb`: used for search engines and preview-card linking when sharing links on social media. Replace the `"Add something here.."` with your own data
- `_font_import_links.html.erb`: Include any fonts from any CDN (default is OpenSans from Google Fonts)
- `_ionicons.html.erb`: Optional Ionicons import from CDN. use `<ion-icon name="person"></ion-icon>` syntax in your `html.erb` or `.js` react files or remove if you don't want to use it. The icon tag also supports tailwind classes

2. Replace `favicon.png` and `preview-card.png`:

- `app/assets/images/favicon.png`: is the little icon that appears in the browser tab or as the icon for a bookmark in your browsers toolbar. a favicon should be `96x96` pixels in size.
- `app/assets/images/preview-card.png`: is the preview image card that is generated by default when your website is shared on social media or in other places such as a text message on a phone for instance. It's common for preview cards to be generated automatically to match the content of the page that's being shared but in this case we will stick with a standard generic perview-card image. The size of a preview card must be at least `2361x1000` pixels in size. It is also recommended that you optimize your preview-card image to reduce it's size. `image-optim` works well. Google it.

---

#### Common Errors & Troubleshooting

**error**:

```bash
Error response from daemon: OCI runtime create failed: container_linux.go:370: starting container process caused: exec: "./docker_entrypoint.sh": permission denied: unknown
```

**solution**: `chmod u+x docker_entrypoint.sh`

**error**:
`bash: /usr/src/app/bin/webpack-dev-server: /usr/bin/env: bad interpreter: Permission denied`

**solution**: `chmod +x app/bin/webpack-dev-server`

**Having issues with Docker setup and want an easy way to reset your docker containers/images/volumes while you debug?**

- Create an alias to quickly perform a hard-rebuild on your project containers making it quicker to diagnose, iterate and fix errors:

```bash
# ~/.zshrc
# WARNING: this will remove docker containers/images/volumes
# globally on your machine!! USE AT YOUR OWN RISK!
alias hardrebuild="
  docker-compose down --remove orphans &&
  docker system prune -a -f &&
  docker volume prune -f &&
  docker-compose build &&
  docker-compose run app yarn install --check-files &&
  docker-compose run app bundle install &&
  docker-compose run app bundle exec rails db:create &&
  docker-compose run app bundle exec rails db:migrate &&
  docker-compose run app bundle exec rails db:seed &&
  docker-compose down --remove orphans &&
  docker-compose up --remove-orphans
  "
```
